---
title: "session3_resvised_solutions"
author: ""
date: "2024-03-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Overview

This session will aim to give you a chance to work through a problem that may be similar to one you would face your daily role. It will use functions we have covered in session 1 and 2, as well as some helpful new functions. 

## Section 1: Importing dataset 

### 1.1: Read in visits2011.csv

The data are in the folder "intro_to_r/session3/Data"

```{r import_csv}
library(tidyverse)
setwd("C:/Users/u415537/R/R Training/intro_to_r/session3")
visits_csv <- read_csv("Data/visits2011.csv")

```

### 1.2: Read in visits201213.xlsx

Hint: use the readxl package. Use the command ?readxl to view the help page

```{r import_excel}
#import library 
library(readxl)
setwd("C:/Users/u415537/R/R Training/intro_to_r/session3")
visits_xl <- read_excel("Data/visits201213.xlsx")

```

### 1.3: Whats the difference between these two datasets?

Depends on the functions used to read the datasets in. If all else is the same, the difference is the period covered.

### 1.4: Stretch: Read in TRNG.ALL_VISITS dataset from SAS. 

Hint: use the function read_sas in the haven package to read in SAS datafiles.

The SAS libraries are located on the shared drive "//s0177a/sasdata1/<path>/<filename>.sas7bdat". Note that the folder names may be different to that seen in the SAS server.

You can use proc contents in SAS to find the exact file path.

```{r import_SAS}

all_visits_sas <- haven::read_sas("//s0177a/sasdata1/training/all_visits.sas7bdat") 
```


## Section 2: Manipulating data

### 2.1: Combine datasets

Use functions from earlier in the course to combine the datasets

```{r combine}

all_visits = bind_rows(visits_csv,visits_xl) %>% glimpse()

```

### 2.2: Pivot data into tidy format

"tidy" format is a long data format with one measurement per row.

```{r pivot}
all_visits_long <- all_visits %>% 
  pivot_longer(-c("period", "source3"),
               names_to= "holiday_type", 
               values_to = "no_of_trips") %>% glimpse()
```

### 2.3: Create new dataset using tibble so use as a lookup table to add the season corresponding to each month. 

e.g. Winter: Dec, Jan, Feb/ Spring: March, April, May/ Summer: June, July, August/ Autumn: Sep, Oct, nov


```{r lookup}
# Create the lookup
seasons <- tibble(month =seq(1,12), 
                  season = c(rep("winter", 2), rep("spring", 3),rep("summer", 3), rep("autumn", 3),"winter"))

# Create the match variable
all_visits_months = all_visits_long %>% 
  mutate(month = substr(period,5,6) %>% as.numeric()) %>% glimpse()

# Combine the datasets
all_visits_seasons = all_visits_months %>% 
  left_join(seasons, by = "month") %>% 
  # Optionally, remove the match variable as it isn't required
  select(-month) %>% glimpse()

```


### 2.4: Create a date variable using the "period" column

```{r dates}
library(tidyverse)
library(lubridate)

all_visits_date <- all_visits_seasons %>% 
  mutate(date = paste0(period,"01") %>% 
           as_date()) %>% glimpse()

```

